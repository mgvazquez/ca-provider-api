---
version: "3.8"

services:
  ca-provider:
    build:
      context: .
      args:
        VERSION: ${STEP_CA_VERSION:-0.15.15}
    restart: always
    tty: true
    stdin_open: true
    ports:
      - "443:443"
    environment:
      CI_DEBUG_TRACE: "${CI_DEBUG_TRACE:-False}"
      CA_PROVIDER_LONG_NAME: "${CA_PROVIDER_LONG_NAME:-'Scabb Island'}"
      CA_PROVIDER_SHORT_NAME: "${CA_PROVIDER_SHORT_NAME:-scbbi}"
      CA_PROVIDER_URL: "${CA_PROVIDER_URL:-ca.scabb-island.com.ar}"
      CA_PROVIDER_MAIL: "${CA_PROVIDER_MAIL:-'acme@scabb-island.com.ar'}"
      ROOT_CA_DUMMY: "${ROOT_CA_DUMMY:-true}"
    volumes:
      - ${PWD}/extras/entrypoint.sh:/app/entrypoint.sh
      - ${PWD}/extras/logger.sh:/app/logger.sh
      - ${PWD}/step-home:/home/step
      - ${PWD}/ca-files:/certs